<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style> body { margin: 0; } </style>
    <title>scp-graph</title>
    <script src="//unpkg.com/force-graph"></script>
    <!--<script src="../../dist/force-graph.js"></script>-->
    <style>
        body{
            font-family: Arial;
        }

        .sidenav {
            scrollbar-color: #495AD3 #2C2C2D;
            scrollbar-width: thin;
            direction: rtl;
            height: 100%;
            position: fixed;
            z-index: 1;
            background-color: black;
            overflow-x: hidden;
            transition: 0.2s;
        }

        .flex-col {
            display: flex;
            flex-direction: column;
        }

        .flex-col > div {
            width: 100%;
        }

        .flex-row {
            display: flex;
            flex-direction: row;
        }

        .flex-row > div {
            flex: 1 1 0;
            width: 0;
        }

        /*style of divs*/

        #stil1{
            font-size: 11px;
            background-color: #121212;
            text-align: center;
            color: #9F9F9F;
        }

        #stil2{
            font-size: 11px;
            background-color: black;
            text-align: left;
            color: #C3C3C3;
        }
        #stil2:hover {
            background: #495AD3;
        }

        .title{
            font-weight: bold;
            padding-bottom: 5px;
            padding-top: 5px;
        }

        /*Button animation*/


        .button {
            cursor:pointer;
            font-size: 12px;
            padding-top: 7px;
            padding-bottom: 7px;
            width: 100%;
            display: block;
            background: linear-gradient(to right, #495AD3 50%,black 50%);
            background-size: 201% 100%;
            background-position: right bottom;
            transition: all .2s ease-out;
        }

        .button:hover {
            background-position: left bottom;
        }

        .text {
            margin-left:8px;
            color: #C3C3C3;
            display: block;
        }

        /*BAR*/


    </style>
</head>

<body>

<span style="font-size: 4vmin;cursor:pointer;position: absolute;left: 10px;right: 0;" onclick="openNav()">&#9776;</span>

<div id="mySidenav" class="sidenav">
        <div class="flex-col" id="stil1">
            <div class="side-block media" style="padding: 10px 0; background: black;">
                <div style="text-align: center;text-decoration: none;">
                    <a style="text-decoration: none;" href="https://discord.com/invite/scp">
                        <img src="https://scp-wiki.wikidot.com/local--files/nav:side/icon-Discord-2023.png" alt="Discord" class="image">
                    </a>
                    <a style="text-decoration: none;" href="https://www.tiktok.com/@scpwikiofficial?">
                        <img src="https://scp-wiki.wdfiles.com/local--files/nav%3Aside/social-tiktok.png" alt="TikTok" class="image">
                    </a>
                    <a style="text-decoration: none;" href="https://www.twitch.tv/scpwiki">
                        <img src="https://scp-wiki.wdfiles.com/local--files/nav:side/social-twitch.png" alt="Twitch" class="image">
                    </a>
                    <a style="text-decoration: none;" href="https://www.instagram.com/scpfoundationwiki">
                        <img src="https://scp-wiki.wdfiles.com/local--files/nav:side/social-instagram.png" alt="Instagram" class="image">
                    </a>
                    <a style="text-decoration: none;" href="https://www.reddit.com/r/SCP">
                        <img src="https://scp-wiki.wdfiles.com/local--files/nav:side/social-reddit.png" alt="Reddit" class="image">
                    </a>
                    <a style="text-decoration: none;" href="https://twitter.com/scpwiki">
                        <img src="https://scp-wiki.wdfiles.com/local--files/nav:side/social-twitter.png" alt="Twitter" class="image">
                    </a>
                    <a style="text-decoration: none;" href="https://www.facebook.com/scpfoundation">
                        <img src="https://scp-wiki.wdfiles.com/local--files/nav:side/social-facebook.png" alt="Facebook" class="image">
                    </a>
                </div>
            </div>
            <div>
                <div class="title">OFFICIAL WEBSITE URLS</div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text"><a href="https://scp-wiki.wikidot.com/guide-for-newcomers" style="text-decoration: none;color: #C3C3C3">Guide for Newcomers</a></div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text"><a href="https://scp-wiki.wikidot.com/system:join" style="text-decoration: none;color: #C3C3C3">Join the Site</a></div>
                    </div>
                </div>
                <div class="flex-row" style="font-weight: bold;">
                    <div class="button">
                        <div class="text"><a href="https://scp-wiki.wikidot.com/forum:start" style="text-decoration: none;color: #C3C3C3">Forum</a></div>
                    </div>
                    <div class="button">
                        <div class="text"><a href="https://scp-wiki.wikidot.com/" style="text-decoration: none;color: #C3C3C3">Main</a></div>
                    </div>
                </div>
            </div>
            <div>
                <div class="title">NODE INFORMATION</div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text"><a id="headlink" href="" style="text-decoration: none;color: #C3C3C3">[NO NODE SELECTED]</a></div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text"><a id="connections" href="" style="text-decoration: none;color: #C3C3C3">[NO NODE SELECTED]</a></div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text"><a id="type" href="" style="text-decoration: none;color: #C3C3C3">[NO NODE SELECTED]</a></div>
                    </div>
                </div>
            </div>
            <div>
                <div class="title">SCPS BY SERIES</div>
                <div class="flex-row">
                    <div class="button">
                        <div class="text">V</div>
                    </div>
                    <div class="button">
                        <div class="text">IV</div>
                    </div>
                    <div class="button">
                        <div class="text">III</div>
                    </div>
                    <div class="button">
                        <div class="text">II</div>
                    </div>
                    <div class="button">
                        <div class="text">I</div>
                    </div>
                </div>
                <div class="flex-row">
                    <div class="button">
                        <div class="text">VIII</div>
                    </div>
                    <div class="button">
                        <div class="text">VII</div>
                    </div>
                    <div class="button">
                        <div class="text">VI</div>
                    </div>
                </div>
            </div>
            <div>
                <div class="title">OTHER SCP</div>
                <div class="flex-row" id="stil2">
                    <div class="button">
                        <div class="text">Joke</div>
                    </div>
                    <div class="button">
                        <div class="text">Explained</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">International</div>
                    </div>
                </div>
            </div>
            <div>
                <div class="title">FEED</div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">New Pages</div>
                    </div>
                </div>
                <div class="flex-row" id="stil2">
                    <div class="button">
                        <div class="text">Top rated</div>
                    </div>
                    <div class="button">
                        <div class="text">Shortest</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">Recent Changes</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">New Forum Posts</div>
                    </div>
                </div>
            </div>
            <div>
                <div class="title">STORIES</div>
                <div class="flex-row" id="stil2">
                    <div class="button">
                        <div class="text">Series</div>
                    </div>
                    <div class="button">
                        <div class="text">Tales Hub</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">Groups of Interest</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">GoI Formats</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">Canon Hub</div>
                    </div>
                </div>
            </div>
            <div>
                <div class="title">DISCOVERY</div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">Artwork Hub</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">Curated Lists</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">Curated Tales Series</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">Tag Search</div>
                    </div>
                </div>
            </div>
            <div>
                <div class="title">RANDOM</div>
                <div class="flex-row">
                    <div class="button">
                        <div class="text">Art</div>
                    </div>
                    <div class="button">
                        <div class="text">GoI</div>
                    </div>
                    <div class="button">
                        <div class="text">Tale</div>
                    </div>
                    <div class="button">
                        <div class="text">SCP</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">Random Page</div>
                    </div>
                </div>
            </div>
            <div>
                <div class="title">OTHER LANGUAGES</div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">French</div>
                    </div>
                    <div class="button">
                        <div class="text">Română</div>
                    </div>
                    <div class="button">
                        <div class="closebtn" onclick="closeNav()" style="cursor:pointer;color: #C3C3C3;display: block;margin-left: 8px">Leave</div>
                    </div>
                </div>
            </div>
        </div>
</div>

<div id="graph" ></div>

<script>
    document.getElementById("graph").addEventListener("click", function (e) {
        let x =document.getElementsByClassName("graph-tooltip")[0].style.left;
        let y =document.getElementsByClassName("graph-tooltip")[0].style.top;
        x = parseInt(x);y = parseInt(y);
        if(x<=50 && y<=50)
        {
            openNav();
        }
    });

    function openNav() {
        document.getElementById("mySidenav").style.width = "15%";
    }

    function closeNav() {
        document.getElementById("mySidenav").style.width = "0";
    }
</script>

<script>

    let Graph = null;
    let filters = null;
    /**
     * The JSON database, pulled once and reprocessed to infinity.
     * @type {{
     *  pages: {
     *      id: string,
     *      title: string,
     *      type: number,
     *      links: (string | number)[],
     *      tags: number[],
     *  }[],
     *  tags: string[],
     *  types: string[]
     * }}
     */
    let database = null;

    function proc_db() {
        const site = 'https://scp-wiki.wikidot.com/'
        let graph_json = {};
        graph_json.nodes = database.pages.map((page, idx) => {
            return {
                id: idx,
                ref: site + page.id,
                title: page.title,
                value: Math.sqrt(page.links.length - 1),
                type: database.types[page.type],
                tags: page.tags.map(idx => database.tags[idx]),
                links: page.links
                    .filter((val, idx, arr) => arr.indexOf(val) === idx)
                    .map(ref => site + (typeof ref == 'number' ? db.pages[ref].id : ref))
            };
        });
        let links = database.pages.reduce((accu, elem, idx) => {
            let inrefs = elem.links.filter(l => typeof l == 'number');
            links[idx] = inrefs.filter(l => !accu.hasOwnProperty(l))
                .reduce((obj, l) => {
                    if (obj.hasOwnProperty(l))
                        obj[l]++;
                    else
                        obj[l] = 1;
                    return obj;
                }, Array(10));
            for (let l of inrefs.filter(l => accu.hasOwnProperty(l)))
                accu[l][idx] = (accu[l][idx] || 0) + 1;
        }, Array(database.pages.length));
        graph_json.links = [];
        for (let s in links)
            for (let d in links[s])
                graph_json.push({src: s, dst: d, val: links[s][d]});
        Graph = ForceGraph()(document.getElementById('graph'))
            .graphData(graph_json)
            .nodeId('id')
            .nodeVal('value')
            .nodeLabel('title')
            .nodeAutoColorBy('type')
            .linkSource('src')
            .linkTarget('dst')
            //.d3VelocityDecay(0.2)
            //.d3AlphaMin(0.2)
            .onNodeClick(node => {
                // Center/zoom on node
                Graph.centerAt(node.x, node.y, 1000);
                Graph.zoom(8, 2000);
                let titletag = document.getElementById("headlink");
                titletag.innerHTML="Access fileserv &#9657;"+node.title;
                titletag.href=node.ref;
                let connectiontag = document.getElementById("connections");
                connectiontag.innerHTML = "Number of Edges &#9657;"+node.links.length;
                let typetag = document.getElementById("type");
                typetag.innerHTML = "Type of Node &#9657;"+node.type.toUpperCase();
            });
    }

    fetch('database.json').then(res => res.json()).then((db) => {
        database = db;
        proc_db();
    });

    openNav();
</script>
</body>
</html>