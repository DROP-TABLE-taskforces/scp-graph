<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style> body { margin: 0; } </style>
    <title>scp-graph</title>
    <script src="//unpkg.com/force-graph"></script>
    <!--<script src="../../dist/force-graph.js"></script>-->
    <style>
        body{
            font-family: Arial;
        }

        .sidenav {
            scrollbar-color: #495AD3 #2C2C2D;
            scrollbar-width: thin;
            direction: rtl;
            height: 100%;
            position: fixed;
            z-index: 1;
            background-color: black;
            overflow-x: hidden;
            transition: 0.2s;
        }

        .flex-col {
            display: flex;
            flex-direction: column;
        }

        .flex-col > div {
            width: 100%;
        }

        .flex-row {
            display: flex;
            flex-direction: row;
        }

        .flex-row > div {
            flex: 1 1 0;
            width: 0;
        }

        /*style of divs*/

        #stil1{
            font-size: 11px;
            background-color: #121212;
            text-align: center;
            color: #9F9F9F;
        }

        #stil2{
            font-size: 11px;
            background-color: black;
            text-align: left;
            color: #C3C3C3;
        }
        #stil2:hover {
            background: #495AD3;
        }

        .title{
            font-weight: bold;
            padding-bottom: 5px;
            padding-top: 5px;
        }

        /*Button animation*/


        .button {
            cursor:pointer;
            font-size: 12px;
            padding-top: 7px;
            padding-bottom: 7px;
            width: 100%;
            display: block;
            background: linear-gradient(to right, #495AD3 50%,black 50%);
            background-size: 200% 100%;
            background-position: right bottom;
            transition: all .2s ease-out;
        }

        .button:hover {
            background-position: left bottom;
        }

        .text {
            margin-left:8px;
            color: #C3C3C3;
            display: block;
        }

        /*BAR*/


    </style>
</head>

<body>

<span style="font-size: 4vmin;cursor:pointer;position: absolute;left: 10px;right: 0;" onclick="openNav()">&#9776;</span>

<div id="mySidenav" class="sidenav">
        <div class="flex-col" id="stil1">
            <div class="side-block media" style="padding: 10px 0; background: black;">
                <div style="text-align: center;text-decoration: none;">
                    <a style="text-decoration: none;" href="https://discord.com/invite/scp">
                        <img src="https://scp-wiki.wikidot.com/local--files/nav:side/icon-Discord-2023.png" alt="Discord" class="image">
                    </a>
                    <a style="text-decoration: none;" href="https://www.tiktok.com/@scpwikiofficial?">
                        <img src="https://scp-wiki.wdfiles.com/local--files/nav%3Aside/social-tiktok.png" alt="TikTok" class="image">
                    </a>
                    <a style="text-decoration: none;" href="https://www.twitch.tv/scpwiki">
                        <img src="https://scp-wiki.wdfiles.com/local--files/nav:side/social-twitch.png" alt="Twitch" class="image">
                    </a>
                    <a style="text-decoration: none;" href="https://www.instagram.com/scpfoundationwiki">
                        <img src="https://scp-wiki.wdfiles.com/local--files/nav:side/social-instagram.png" alt="Instagram" class="image">
                    </a>
                    <a style="text-decoration: none;" href="https://www.reddit.com/r/SCP">
                        <img src="https://scp-wiki.wdfiles.com/local--files/nav:side/social-reddit.png" alt="Reddit" class="image">
                    </a>
                    <a style="text-decoration: none;" href="https://twitter.com/scpwiki">
                        <img src="https://scp-wiki.wdfiles.com/local--files/nav:side/social-twitter.png" alt="Twitter" class="image">
                    </a>
                    <a style="text-decoration: none;" href="https://www.facebook.com/scpfoundation">
                        <img src="https://scp-wiki.wdfiles.com/local--files/nav:side/social-facebook.png" alt="Facebook" class="image">
                    </a>
                </div>
            </div>
            <div>
                <div class="title">GETTING STARTED</div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">Guide for Newcomers</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">Join the site</div>
                    </div>
                </div>
                <div class="flex-row" id="stil2">
                    <div class="button">
                        <div class="text">FAQ</div>
                    </div>
                    <div class="button">
                        <div class="text">Contribute</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">Universe Hub</div>
                    </div>
                </div>
                <div class="flex-row" style="font-weight: bold;">
                    <div class="button">
                        <div class="text">Forum</div>
                    </div>
                    <div class="button">
                        <div class="text">Main</div>
                    </div>
                </div>
            </div>
            <div>
                <div class="title">SCPS BY SERIES</div>
                <div class="flex-row">
                    <div class="button">
                        <div class="text">V</div>
                    </div>
                    <div class="button">
                        <div class="text">IV</div>
                    </div>
                    <div class="button">
                        <div class="text">III</div>
                    </div>
                    <div class="button">
                        <div class="text">II</div>
                    </div>
                    <div class="button">
                        <div class="text">I</div>
                    </div>
                </div>
                <div class="flex-row">
                    <div class="button">
                        <div class="text">VIII</div>
                    </div>
                    <div class="button">
                        <div class="text">VII</div>
                    </div>
                    <div class="button">
                        <div class="text">VI</div>
                    </div>
                </div>
            </div>
            <div>
                <div class="title">OTHER SCP</div>
                <div class="flex-row" id="stil2">
                    <div class="button">
                        <div class="text">Joke</div>
                    </div>
                    <div class="button">
                        <div class="text">Explained</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">International</div>
                    </div>
                </div>
            </div>
            <div>
                <div class="title">FEED</div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">New Pages</div>
                    </div>
                </div>
                <div class="flex-row" id="stil2">
                    <div class="button">
                        <div class="text">Top rated</div>
                    </div>
                    <div class="button">
                        <div class="text">Shortest</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">Recent Changes</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">New Forum Posts</div>
                    </div>
                </div>
            </div>
            <div>
                <div class="title">STORIES</div>
                <div class="flex-row" id="stil2">
                    <div class="button">
                        <div class="text">Series</div>
                    </div>
                    <div class="button">
                        <div class="text">Tales Hub</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">Groups of Interest</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">GoI Formats</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">Canon Hub</div>
                    </div>
                </div>
            </div>
            <div>
                <div class="title">DISCOVERY</div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">Artwork Hub</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">Curated Lists</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">Curated Tales Series</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">Tag Search</div>
                    </div>
                </div>
            </div>
            <div>
                <div class="title">RANDOM</div>
                <div class="flex-row">
                    <div class="button">
                        <div class="text">Art</div>
                    </div>
                    <div class="button">
                        <div class="text">GoI</div>
                    </div>
                    <div class="button">
                        <div class="text">Tale</div>
                    </div>
                    <div class="button">
                        <div class="text">SCP</div>
                    </div>
                </div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">Random Page</div>
                    </div>
                </div>
            </div>
            <div>
                <div class="title">OTHER LANGUAGES</div>
                <div class="flex-container" id="stil2">
                    <div class="button">
                        <div class="text">French</div>
                    </div>
                    <div class="button">
                        <div class="text">Română</div>
                    </div>
                    <div class="button">
                        <div class="closebtn" onclick="closeNav()" style="cursor:pointer;color: #C3C3C3;display: block;margin-left: 8px">Leave</div>
                    </div>
                </div>
            </div>
        </div>
</div>

<div id="graph" ></div>

<script>
    document.getElementById("graph").addEventListener("click", function (e) {
        let x =document.getElementsByClassName("graph-tooltip")[0].style.left;
        let y =document.getElementsByClassName("graph-tooltip")[0].style.top;
        x = parseInt(x);y = parseInt(y);
        if(x<=50 && y<=50)
        {
            openNav();
        }
    });

    function openNav() {
        document.getElementById("mySidenav").style.width = "15%";
    }

    function closeNav() {
        document.getElementById("mySidenav").style.width = "0";
    }
</script>

<script>
    /**
     * @type {{
     *  pages: {
     *      id: string,
     *      title: string,
     *      type: number,
     *      links: (number | string)[],
     *      tags: number[],
     *  }[],
     *  tags: string[],
     *  types: string[]
     * }}
     */
    let database = await (await fetch('../database.json')).json();
    
    const site = 'https://scp-wiki.wikidot.com/'
    let graph_json = {};
    graph_json.nodes = database.pages.map((page, idx) => {
        return {
            id: idx,
            ref: site + page.id,
            title: page.title,
            type: database.types[page.type],
            tags: page.tags.map(idx => database.tags[idx]),
            links: page.links.map((ref) => site + (typeof ref == 'number' ? database.pages[ref].id : ref))
        };
    });
    graph_json.links = database.pages.reduce((accu, elem, idx) => {
        accu.concat(elem.links.filter(ref => typeof ref == 'number').map(ref => {
            return {
                src: idx,
                dst: ref,
                value: 1
            };
        }));
    }, []);

    console.log(graph_json.links[102]);
    console.log(graph_json.nodes[57]);

    fetch('miserables.json').then(res => res.json()).then(data => {
        const Graph = ForceGraph()
        (document.getElementById('graph'))
            .graphData(data)
            .nodeId('id')
            .nodeVal('val')
            .nodeLabel('id')
            .nodeAutoColorBy('group')
            .linkSource('source')
            .linkTarget('target')
    });
    openNav();
</script>
</body>
</html>